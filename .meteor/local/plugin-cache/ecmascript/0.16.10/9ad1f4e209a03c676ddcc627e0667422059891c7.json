{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/anshul/Masters/Internship/POC/Meteor_Mobile/mieweb_push_auth/imports/api/deviceLogs.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"imports/api/deviceLogs.js","filename":"/Users/anshul/Masters/Internship/POC/Meteor_Mobile/mieweb_push_auth/imports/api/deviceLogs.js","inputSourceMap":{"version":3,"names":["Mongo","check","SHA256","DeviceLogs","Collection","generateAppId","deviceUUID","email","creationTime","combinedString","substring","Meteor","isServer","startup","createIndex","userId","appId","methods","deviceLogs.upsert","data","String","fcmToken","deviceInfo","Object","Date","toISOString","console","log","upsertAsync","$set","lastUpdated","$setOnInsert","createdAt","deviceLogs.updateToken","updateAsync","deviceLogs.getFCMTokenByAppId","deviceLog","findOneAsync","Error","deviceLogs.getFCMTokenByDeviceId","deviceLogs.getByAppId","result","publish","find"],"sources":["imports/api/deviceLogs.js"],"sourcesContent":["import { Mongo } from 'meteor/mongo';\nimport { check } from 'meteor/check';\nimport { SHA256 } from 'meteor/sha'; \n\nexport const DeviceLogs = new Mongo.Collection('deviceLogs');\n\n\n\n// Add generateAppId utility function\nconst generateAppId = (deviceUUID, email, creationTime) => {\n    const combinedString = `${deviceUUID}:${email}:${creationTime}`;\n    return SHA256(combinedString).substring(0, 32);\n  };\n  \n\n// Create indexes for better query performance\nif (Meteor.isServer) {\n  Meteor.startup(() => {\n    DeviceLogs.createIndex({ userId: 1 });\n    DeviceLogs.createIndex({ deviceUUID: 1 });\n    DeviceLogs.createIndex({ email: 1 });\n    DeviceLogs.createIndex({ appId: 1 });\n  });\n}\n\n// Define methods for DeviceLogs\nMeteor.methods({\n    'deviceLogs.upsert': async function(data) {\n        check(data, {\n          userId: String,\n          email: String,\n          deviceUUID: String,\n          fcmToken: String,\n          deviceInfo: Object,\n        });\n      \n        const creationTime = new Date().toISOString();\n        const appId = generateAppId(data.deviceUUID, data.email, creationTime);\n        console.log('Generated appId during upsert:', appId); // Add this log\n        \n        return DeviceLogs.upsertAsync(\n          {\n            userId: data.userId,\n            deviceUUID: data.deviceUUID,\n          },\n          {\n            $set: {\n              email: data.email,\n              fcmToken: data.fcmToken,\n              appId: appId,\n              lastUpdated: new Date(),\n            },\n            $setOnInsert: {\n              createdAt: new Date(),\n            },\n          }\n        );\n      },\n  'deviceLogs.updateToken'(userId, deviceUUID, fcmToken) {\n    check(userId, String);\n    check(deviceUUID, String);\n    check(fcmToken, String);\n\n    return DeviceLogs.updateAsync(\n      { \n        userId: userId,\n        deviceUUID: deviceUUID \n      },\n      {\n        $set: {\n          fcmToken: fcmToken,\n          lastUpdated: new Date()\n        }\n      }\n    );\n  },\n  'deviceLogs.getFCMTokenByAppId': async function(appId) {\n    check(appId, String);\n    \n    const deviceLog = await DeviceLogs.findOneAsync({ appId: appId });\n    \n    if (!deviceLog) {\n      throw new Meteor.Error('invalid-app-id', 'No device found with this App ID');\n    }\n    \n    return deviceLog.fcmToken;\n  },\n  'deviceLogs.getFCMTokenByDeviceId': async function(deviceUUID) {\n    check(deviceUUID, String);\n    \n    const deviceLog = await DeviceLogs.findOneAsync({ deviceUUID: deviceUUID });\n    \n    if (!deviceLog) {\n      throw new Meteor.Error('invalid-app-id', 'No device found with this Device ID');\n    }\n    \n    return deviceLog.fcmToken;\n  },\n  \n  // Also fix the debug method\n  'deviceLogs.getByAppId': async function(appId) {\n    check(appId, String);\n    const result = await DeviceLogs.findOneAsync({ appId });\n    console.log('Looking for appId:', appId);\n    console.log('Found device log:', result);\n    return result;\n  }\n});\n\n// Publish device logs\nif (Meteor.isServer) {\n  Meteor.publish('deviceLogs.byUser', function(userId) {\n    check(userId, String);\n    return DeviceLogs.find({ userId: userId });\n  });\n\n  Meteor.publish('deviceLogs.byDevice', function(deviceUUID) {\n    check(deviceUUID, String);\n    return DeviceLogs.find({ deviceUUID: deviceUUID });\n  });\n}"],"mappings":"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","ignoreList":[]},"targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/anshul/Masters/Internship/POC/Meteor_Mobile/mieweb_push_auth","root":"/Users/anshul/Masters/Internship/POC/Meteor_Mobile/mieweb_push_auth","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/anshul/Masters/Internship/POC/Meteor_Mobile/mieweb_push_auth/imports/api/deviceLogs.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/api/deviceLogs.js","inputSourceMap":{"version":3,"names":["Mongo","check","SHA256","DeviceLogs","Collection","generateAppId","deviceUUID","email","creationTime","combinedString","substring","Meteor","isServer","startup","createIndex","userId","appId","methods","deviceLogs.upsert","data","String","fcmToken","deviceInfo","Object","Date","toISOString","console","log","upsertAsync","$set","lastUpdated","$setOnInsert","createdAt","deviceLogs.updateToken","updateAsync","deviceLogs.getFCMTokenByAppId","deviceLog","findOneAsync","Error","deviceLogs.getFCMTokenByDeviceId","deviceLogs.getByAppId","result","publish","find"],"sources":["imports/api/deviceLogs.js"],"sourcesContent":["import { Mongo } from 'meteor/mongo';\nimport { check } from 'meteor/check';\nimport { SHA256 } from 'meteor/sha'; \n\nexport const DeviceLogs = new Mongo.Collection('deviceLogs');\n\n\n\n// Add generateAppId utility function\nconst generateAppId = (deviceUUID, email, creationTime) => {\n    const combinedString = `${deviceUUID}:${email}:${creationTime}`;\n    return SHA256(combinedString).substring(0, 32);\n  };\n  \n\n// Create indexes for better query performance\nif (Meteor.isServer) {\n  Meteor.startup(() => {\n    DeviceLogs.createIndex({ userId: 1 });\n    DeviceLogs.createIndex({ deviceUUID: 1 });\n    DeviceLogs.createIndex({ email: 1 });\n    DeviceLogs.createIndex({ appId: 1 });\n  });\n}\n\n// Define methods for DeviceLogs\nMeteor.methods({\n    'deviceLogs.upsert': async function(data) {\n        check(data, {\n          userId: String,\n          email: String,\n          deviceUUID: String,\n          fcmToken: String,\n          deviceInfo: Object,\n        });\n      \n        const creationTime = new Date().toISOString();\n        const appId = generateAppId(data.deviceUUID, data.email, creationTime);\n        console.log('Generated appId during upsert:', appId); // Add this log\n        \n        return DeviceLogs.upsertAsync(\n          {\n            userId: data.userId,\n            deviceUUID: data.deviceUUID,\n          },\n          {\n            $set: {\n              email: data.email,\n              fcmToken: data.fcmToken,\n              appId: appId,\n              lastUpdated: new Date(),\n            },\n            $setOnInsert: {\n              createdAt: new Date(),\n            },\n          }\n        );\n      },\n  'deviceLogs.updateToken'(userId, deviceUUID, fcmToken) {\n    check(userId, String);\n    check(deviceUUID, String);\n    check(fcmToken, String);\n\n    return DeviceLogs.updateAsync(\n      { \n        userId: userId,\n        deviceUUID: deviceUUID \n      },\n      {\n        $set: {\n          fcmToken: fcmToken,\n          lastUpdated: new Date()\n        }\n      }\n    );\n  },\n  'deviceLogs.getFCMTokenByAppId': async function(appId) {\n    check(appId, String);\n    \n    const deviceLog = await DeviceLogs.findOneAsync({ appId: appId });\n    \n    if (!deviceLog) {\n      throw new Meteor.Error('invalid-app-id', 'No device found with this App ID');\n    }\n    \n    return deviceLog.fcmToken;\n  },\n  'deviceLogs.getFCMTokenByDeviceId': async function(deviceUUID) {\n    check(deviceUUID, String);\n    \n    const deviceLog = await DeviceLogs.findOneAsync({ deviceUUID: deviceUUID });\n    \n    if (!deviceLog) {\n      throw new Meteor.Error('invalid-app-id', 'No device found with this Device ID');\n    }\n    \n    return deviceLog.fcmToken;\n  },\n  \n  // Also fix the debug method\n  'deviceLogs.getByAppId': async function(appId) {\n    check(appId, String);\n    const result = await DeviceLogs.findOneAsync({ appId });\n    console.log('Looking for appId:', appId);\n    console.log('Found device log:', result);\n    return result;\n  }\n});\n\n// Publish device logs\nif (Meteor.isServer) {\n  Meteor.publish('deviceLogs.byUser', function(userId) {\n    check(userId, String);\n    return DeviceLogs.find({ userId: userId });\n  });\n\n  Meteor.publish('deviceLogs.byDevice', function(deviceUUID) {\n    check(deviceUUID, String);\n    return DeviceLogs.find({ deviceUUID: deviceUUID });\n  });\n}"],"mappings":";AAAA,SAASA,KAAK,QAAQ,cAAc;AACpC,SAASC,KAAK,QAAQ,cAAc;AACpC,SAASC,MAAM,QAAQ,YAAY;AAEnC,OAAO,MAAMC,UAAU,GAAG,IAAIH,KAAK,CAACI,UAAU,CAAC,YAAY,CAAC;;AAI5D;AACA,MAAMC,aAAa,GAAGA,CAACC,UAAU,EAAEC,KAAK,EAAEC,YAAY,KAAK;EACvD,MAAMC,cAAc,GAAG,GAAGH,UAAU,IAAIC,KAAK,IAAIC,YAAY,EAAE;EAC/D,OAAON,MAAM,CAACO,cAAc,CAAC,CAACC,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC;AAChD,CAAC;;AAGH;AACA,IAAIC,MAAM,CAACC,QAAQ,EAAE;EACnBD,MAAM,CAACE,OAAO,CAAC,MAAM;IACnBV,UAAU,CAACW,WAAW,CAAC;MAAEC,MAAM,EAAE;IAAE,CAAC,CAAC;IACrCZ,UAAU,CAACW,WAAW,CAAC;MAAER,UAAU,EAAE;IAAE,CAAC,CAAC;IACzCH,UAAU,CAACW,WAAW,CAAC;MAAEP,KAAK,EAAE;IAAE,CAAC,CAAC;IACpCJ,UAAU,CAACW,WAAW,CAAC;MAAEE,KAAK,EAAE;IAAE,CAAC,CAAC;EACtC,CAAC,CAAC;AACJ;;AAEA;AACAL,MAAM,CAACM,OAAO,CAAC;EACX,mBAAmB,EAAE,eAAAC,CAAeC,IAAI,EAAE;IACtClB,KAAK,CAACkB,IAAI,EAAE;MACVJ,MAAM,EAAEK,MAAM;MACdb,KAAK,EAAEa,MAAM;MACbd,UAAU,EAAEc,MAAM;MAClBC,QAAQ,EAAED,MAAM;MAChBE,UAAU,EAAEC;IACd,CAAC,CAAC;IAEF,MAAMf,YAAY,GAAG,IAAIgB,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;IAC7C,MAAMT,KAAK,GAAGX,aAAa,CAACc,IAAI,CAACb,UAAU,EAAEa,IAAI,CAACZ,KAAK,EAAEC,YAAY,CAAC;IACtEkB,OAAO,CAACC,GAAG,CAAC,gCAAgC,EAAEX,KAAK,CAAC,CAAC,CAAC;;IAEtD,OAAOb,UAAU,CAACyB,WAAW,CAC3B;MACEb,MAAM,EAAEI,IAAI,CAACJ,MAAM;MACnBT,UAAU,EAAEa,IAAI,CAACb;IACnB,CAAC,EACD;MACEuB,IAAI,EAAE;QACJtB,KAAK,EAAEY,IAAI,CAACZ,KAAK;QACjBc,QAAQ,EAAEF,IAAI,CAACE,QAAQ;QACvBL,KAAK,EAAEA,KAAK;QACZc,WAAW,EAAE,IAAIN,IAAI,CAAC;MACxB,CAAC;MACDO,YAAY,EAAE;QACZC,SAAS,EAAE,IAAIR,IAAI,CAAC;MACtB;IACF,CACF,CAAC;EACH,CAAC;EACL,wBAAwBS,CAAClB,MAAM,EAAET,UAAU,EAAEe,QAAQ,EAAE;IACrDpB,KAAK,CAACc,MAAM,EAAEK,MAAM,CAAC;IACrBnB,KAAK,CAACK,UAAU,EAAEc,MAAM,CAAC;IACzBnB,KAAK,CAACoB,QAAQ,EAAED,MAAM,CAAC;IAEvB,OAAOjB,UAAU,CAAC+B,WAAW,CAC3B;MACEnB,MAAM,EAAEA,MAAM;MACdT,UAAU,EAAEA;IACd,CAAC,EACD;MACEuB,IAAI,EAAE;QACJR,QAAQ,EAAEA,QAAQ;QAClBS,WAAW,EAAE,IAAIN,IAAI,CAAC;MACxB;IACF,CACF,CAAC;EACH,CAAC;EACD,+BAA+B,EAAE,eAAAW,CAAenB,KAAK,EAAE;IACrDf,KAAK,CAACe,KAAK,EAAEI,MAAM,CAAC;IAEpB,MAAMgB,SAAS,GAAG,MAAMjC,UAAU,CAACkC,YAAY,CAAC;MAAErB,KAAK,EAAEA;IAAM,CAAC,CAAC;IAEjE,IAAI,CAACoB,SAAS,EAAE;MACd,MAAM,IAAIzB,MAAM,CAAC2B,KAAK,CAAC,gBAAgB,EAAE,kCAAkC,CAAC;IAC9E;IAEA,OAAOF,SAAS,CAACf,QAAQ;EAC3B,CAAC;EACD,kCAAkC,EAAE,eAAAkB,CAAejC,UAAU,EAAE;IAC7DL,KAAK,CAACK,UAAU,EAAEc,MAAM,CAAC;IAEzB,MAAMgB,SAAS,GAAG,MAAMjC,UAAU,CAACkC,YAAY,CAAC;MAAE/B,UAAU,EAAEA;IAAW,CAAC,CAAC;IAE3E,IAAI,CAAC8B,SAAS,EAAE;MACd,MAAM,IAAIzB,MAAM,CAAC2B,KAAK,CAAC,gBAAgB,EAAE,qCAAqC,CAAC;IACjF;IAEA,OAAOF,SAAS,CAACf,QAAQ;EAC3B,CAAC;EAED;EACA,uBAAuB,EAAE,eAAAmB,CAAexB,KAAK,EAAE;IAC7Cf,KAAK,CAACe,KAAK,EAAEI,MAAM,CAAC;IACpB,MAAMqB,MAAM,GAAG,MAAMtC,UAAU,CAACkC,YAAY,CAAC;MAAErB;IAAM,CAAC,CAAC;IACvDU,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAEX,KAAK,CAAC;IACxCU,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAEc,MAAM,CAAC;IACxC,OAAOA,MAAM;EACf;AACF,CAAC,CAAC;;AAEF;AACA,IAAI9B,MAAM,CAACC,QAAQ,EAAE;EACnBD,MAAM,CAAC+B,OAAO,CAAC,mBAAmB,EAAE,UAAS3B,MAAM,EAAE;IACnDd,KAAK,CAACc,MAAM,EAAEK,MAAM,CAAC;IACrB,OAAOjB,UAAU,CAACwC,IAAI,CAAC;MAAE5B,MAAM,EAAEA;IAAO,CAAC,CAAC;EAC5C,CAAC,CAAC;EAEFJ,MAAM,CAAC+B,OAAO,CAAC,qBAAqB,EAAE,UAASpC,UAAU,EAAE;IACzDL,KAAK,CAACK,UAAU,EAAEc,MAAM,CAAC;IACzB,OAAOjB,UAAU,CAACwC,IAAI,CAAC;MAAErC,UAAU,EAAEA;IAAW,CAAC,CAAC;EACpD,CAAC,CAAC;AACJ","ignoreList":[]}}},"code":"!function (module1) {\n  module1.export({\n    DeviceLogs: () => DeviceLogs\n  });\n  let Mongo;\n  module1.link(\"meteor/mongo\", {\n    Mongo(v) {\n      Mongo = v;\n    }\n  }, 0);\n  let check;\n  module1.link(\"meteor/check\", {\n    check(v) {\n      check = v;\n    }\n  }, 1);\n  let SHA256;\n  module1.link(\"meteor/sha\", {\n    SHA256(v) {\n      SHA256 = v;\n    }\n  }, 2);\n  ___INIT_METEOR_FAST_REFRESH(module);\n  const DeviceLogs = new Mongo.Collection('deviceLogs');\n  // Add generateAppId utility function\n  const generateAppId = (deviceUUID, email, creationTime) => {\n    const combinedString = \"\".concat(deviceUUID, \":\").concat(email, \":\").concat(creationTime);\n    return SHA256(combinedString).substring(0, 32);\n  };\n\n  // Create indexes for better query performance\n  if (Meteor.isServer) {\n    Meteor.startup(() => {\n      DeviceLogs.createIndex({\n        userId: 1\n      });\n      DeviceLogs.createIndex({\n        deviceUUID: 1\n      });\n      DeviceLogs.createIndex({\n        email: 1\n      });\n      DeviceLogs.createIndex({\n        appId: 1\n      });\n    });\n  }\n\n  // Define methods for DeviceLogs\n  Meteor.methods({\n    'deviceLogs.upsert': async function (data) {\n      check(data, {\n        userId: String,\n        email: String,\n        deviceUUID: String,\n        fcmToken: String,\n        deviceInfo: Object\n      });\n      const creationTime = new Date().toISOString();\n      const appId = generateAppId(data.deviceUUID, data.email, creationTime);\n      console.log('Generated appId during upsert:', appId); // Add this log\n\n      return DeviceLogs.upsertAsync({\n        userId: data.userId,\n        deviceUUID: data.deviceUUID\n      }, {\n        $set: {\n          email: data.email,\n          fcmToken: data.fcmToken,\n          appId: appId,\n          lastUpdated: new Date()\n        },\n        $setOnInsert: {\n          createdAt: new Date()\n        }\n      });\n    },\n    'deviceLogs.updateToken'(userId, deviceUUID, fcmToken) {\n      check(userId, String);\n      check(deviceUUID, String);\n      check(fcmToken, String);\n      return DeviceLogs.updateAsync({\n        userId: userId,\n        deviceUUID: deviceUUID\n      }, {\n        $set: {\n          fcmToken: fcmToken,\n          lastUpdated: new Date()\n        }\n      });\n    },\n    'deviceLogs.getFCMTokenByAppId': async function (appId) {\n      check(appId, String);\n      const deviceLog = await DeviceLogs.findOneAsync({\n        appId: appId\n      });\n      if (!deviceLog) {\n        throw new Meteor.Error('invalid-app-id', 'No device found with this App ID');\n      }\n      return deviceLog.fcmToken;\n    },\n    'deviceLogs.getFCMTokenByDeviceId': async function (deviceUUID) {\n      check(deviceUUID, String);\n      const deviceLog = await DeviceLogs.findOneAsync({\n        deviceUUID: deviceUUID\n      });\n      if (!deviceLog) {\n        throw new Meteor.Error('invalid-app-id', 'No device found with this Device ID');\n      }\n      return deviceLog.fcmToken;\n    },\n    // Also fix the debug method\n    'deviceLogs.getByAppId': async function (appId) {\n      check(appId, String);\n      const result = await DeviceLogs.findOneAsync({\n        appId\n      });\n      console.log('Looking for appId:', appId);\n      console.log('Found device log:', result);\n      return result;\n    }\n  });\n\n  // Publish device logs\n  if (Meteor.isServer) {\n    Meteor.publish('deviceLogs.byUser', function (userId) {\n      check(userId, String);\n      return DeviceLogs.find({\n        userId: userId\n      });\n    });\n    Meteor.publish('deviceLogs.byDevice', function (deviceUUID) {\n      check(deviceUUID, String);\n      return DeviceLogs.find({\n        deviceUUID: deviceUUID\n      });\n    });\n  }\n}.call(this, module);","map":{"version":3,"names":["DeviceLogs","Mongo","Collection","generateAppId","deviceUUID","email","creationTime","combinedString","concat","SHA256","substring","Meteor","isServer","startup","createIndex","userId","appId","methods","deviceLogs.upsert","data","check","String","fcmToken","deviceInfo","Object","Date","toISOString","console","log","upsertAsync","$set","lastUpdated","$setOnInsert","createdAt","deviceLogs.updateToken","updateAsync","deviceLogs.getFCMTokenByAppId","deviceLog","findOneAsync","Error","deviceLogs.getFCMTokenByDeviceId","deviceLogs.getByAppId","result","publish","find","call","module"],"sources":["imports/api/deviceLogs.js"],"sourcesContent":["import { Mongo } from 'meteor/mongo';\nimport { check } from 'meteor/check';\nimport { SHA256 } from 'meteor/sha'; \n\nexport const DeviceLogs = new Mongo.Collection('deviceLogs');\n\n\n\n// Add generateAppId utility function\nconst generateAppId = (deviceUUID, email, creationTime) => {\n    const combinedString = `${deviceUUID}:${email}:${creationTime}`;\n    return SHA256(combinedString).substring(0, 32);\n  };\n  \n\n// Create indexes for better query performance\nif (Meteor.isServer) {\n  Meteor.startup(() => {\n    DeviceLogs.createIndex({ userId: 1 });\n    DeviceLogs.createIndex({ deviceUUID: 1 });\n    DeviceLogs.createIndex({ email: 1 });\n    DeviceLogs.createIndex({ appId: 1 });\n  });\n}\n\n// Define methods for DeviceLogs\nMeteor.methods({\n    'deviceLogs.upsert': async function(data) {\n        check(data, {\n          userId: String,\n          email: String,\n          deviceUUID: String,\n          fcmToken: String,\n          deviceInfo: Object,\n        });\n      \n        const creationTime = new Date().toISOString();\n        const appId = generateAppId(data.deviceUUID, data.email, creationTime);\n        console.log('Generated appId during upsert:', appId); // Add this log\n        \n        return DeviceLogs.upsertAsync(\n          {\n            userId: data.userId,\n            deviceUUID: data.deviceUUID,\n          },\n          {\n            $set: {\n              email: data.email,\n              fcmToken: data.fcmToken,\n              appId: appId,\n              lastUpdated: new Date(),\n            },\n            $setOnInsert: {\n              createdAt: new Date(),\n            },\n          }\n        );\n      },\n  'deviceLogs.updateToken'(userId, deviceUUID, fcmToken) {\n    check(userId, String);\n    check(deviceUUID, String);\n    check(fcmToken, String);\n\n    return DeviceLogs.updateAsync(\n      { \n        userId: userId,\n        deviceUUID: deviceUUID \n      },\n      {\n        $set: {\n          fcmToken: fcmToken,\n          lastUpdated: new Date()\n        }\n      }\n    );\n  },\n  'deviceLogs.getFCMTokenByAppId': async function(appId) {\n    check(appId, String);\n    \n    const deviceLog = await DeviceLogs.findOneAsync({ appId: appId });\n    \n    if (!deviceLog) {\n      throw new Meteor.Error('invalid-app-id', 'No device found with this App ID');\n    }\n    \n    return deviceLog.fcmToken;\n  },\n  'deviceLogs.getFCMTokenByDeviceId': async function(deviceUUID) {\n    check(deviceUUID, String);\n    \n    const deviceLog = await DeviceLogs.findOneAsync({ deviceUUID: deviceUUID });\n    \n    if (!deviceLog) {\n      throw new Meteor.Error('invalid-app-id', 'No device found with this Device ID');\n    }\n    \n    return deviceLog.fcmToken;\n  },\n  \n  // Also fix the debug method\n  'deviceLogs.getByAppId': async function(appId) {\n    check(appId, String);\n    const result = await DeviceLogs.findOneAsync({ appId });\n    console.log('Looking for appId:', appId);\n    console.log('Found device log:', result);\n    return result;\n  }\n});\n\n// Publish device logs\nif (Meteor.isServer) {\n  Meteor.publish('deviceLogs.byUser', function(userId) {\n    check(userId, String);\n    return DeviceLogs.find({ userId: userId });\n  });\n\n  Meteor.publish('deviceLogs.byDevice', function(deviceUUID) {\n    check(deviceUUID, String);\n    return DeviceLogs.find({ deviceUUID: deviceUUID });\n  });\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;EAIO,MAAMA,UAAU,GAAG,IAAIC,KAAK,CAACC,UAAU,CAAC,YAAY,CAAC;EAI5D;EACA,MAAMC,aAAa,GAAGA,CAACC,UAAU,EAAEC,KAAK,EAAEC,YAAY,KAAK;IACvD,MAAMC,cAAc,MAAAC,MAAA,CAAMJ,UAAU,OAAAI,MAAA,CAAIH,KAAK,OAAAG,MAAA,CAAIF,YAAY,CAAE;IAC/D,OAAOG,MAAM,CAACF,cAAc,CAAC,CAACG,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC;EAChD,CAAC;;EAGH;EACA,IAAIC,MAAM,CAACC,QAAQ,EAAE;IACnBD,MAAM,CAACE,OAAO,CAAC,MAAM;MACnBb,UAAU,CAACc,WAAW,CAAC;QAAEC,MAAM,EAAE;MAAE,CAAC,CAAC;MACrCf,UAAU,CAACc,WAAW,CAAC;QAAEV,UAAU,EAAE;MAAE,CAAC,CAAC;MACzCJ,UAAU,CAACc,WAAW,CAAC;QAAET,KAAK,EAAE;MAAE,CAAC,CAAC;MACpCL,UAAU,CAACc,WAAW,CAAC;QAAEE,KAAK,EAAE;MAAE,CAAC,CAAC;IACtC,CAAC,CAAC;EACJ;;EAEA;EACAL,MAAM,CAACM,OAAO,CAAC;IACX,mBAAmB,EAAE,eAAAC,CAAeC,IAAI,EAAE;MACtCC,KAAK,CAACD,IAAI,EAAE;QACVJ,MAAM,EAAEM,MAAM;QACdhB,KAAK,EAAEgB,MAAM;QACbjB,UAAU,EAAEiB,MAAM;QAClBC,QAAQ,EAAED,MAAM;QAChBE,UAAU,EAAEC;MACd,CAAC,CAAC;MAEF,MAAMlB,YAAY,GAAG,IAAImB,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;MAC7C,MAAMV,KAAK,GAAGb,aAAa,CAACgB,IAAI,CAACf,UAAU,EAAEe,IAAI,CAACd,KAAK,EAAEC,YAAY,CAAC;MACtEqB,OAAO,CAACC,GAAG,CAAC,gCAAgC,EAAEZ,KAAK,CAAC,CAAC,CAAC;;MAEtD,OAAOhB,UAAU,CAAC6B,WAAW,CAC3B;QACEd,MAAM,EAAEI,IAAI,CAACJ,MAAM;QACnBX,UAAU,EAAEe,IAAI,CAACf;MACnB,CAAC,EACD;QACE0B,IAAI,EAAE;UACJzB,KAAK,EAAEc,IAAI,CAACd,KAAK;UACjBiB,QAAQ,EAAEH,IAAI,CAACG,QAAQ;UACvBN,KAAK,EAAEA,KAAK;UACZe,WAAW,EAAE,IAAIN,IAAI,CAAC;QACxB,CAAC;QACDO,YAAY,EAAE;UACZC,SAAS,EAAE,IAAIR,IAAI,CAAC;QACtB;MACF,CACF,CAAC;IACH,CAAC;IACL,wBAAwBS,CAACnB,MAAM,EAAEX,UAAU,EAAEkB,QAAQ,EAAE;MACrDF,KAAK,CAACL,MAAM,EAAEM,MAAM,CAAC;MACrBD,KAAK,CAAChB,UAAU,EAAEiB,MAAM,CAAC;MACzBD,KAAK,CAACE,QAAQ,EAAED,MAAM,CAAC;MAEvB,OAAOrB,UAAU,CAACmC,WAAW,CAC3B;QACEpB,MAAM,EAAEA,MAAM;QACdX,UAAU,EAAEA;MACd,CAAC,EACD;QACE0B,IAAI,EAAE;UACJR,QAAQ,EAAEA,QAAQ;UAClBS,WAAW,EAAE,IAAIN,IAAI,CAAC;QACxB;MACF,CACF,CAAC;IACH,CAAC;IACD,+BAA+B,EAAE,eAAAW,CAAepB,KAAK,EAAE;MACrDI,KAAK,CAACJ,KAAK,EAAEK,MAAM,CAAC;MAEpB,MAAMgB,SAAS,GAAG,MAAMrC,UAAU,CAACsC,YAAY,CAAC;QAAEtB,KAAK,EAAEA;MAAM,CAAC,CAAC;MAEjE,IAAI,CAACqB,SAAS,EAAE;QACd,MAAM,IAAI1B,MAAM,CAAC4B,KAAK,CAAC,gBAAgB,EAAE,kCAAkC,CAAC;MAC9E;MAEA,OAAOF,SAAS,CAACf,QAAQ;IAC3B,CAAC;IACD,kCAAkC,EAAE,eAAAkB,CAAepC,UAAU,EAAE;MAC7DgB,KAAK,CAAChB,UAAU,EAAEiB,MAAM,CAAC;MAEzB,MAAMgB,SAAS,GAAG,MAAMrC,UAAU,CAACsC,YAAY,CAAC;QAAElC,UAAU,EAAEA;MAAW,CAAC,CAAC;MAE3E,IAAI,CAACiC,SAAS,EAAE;QACd,MAAM,IAAI1B,MAAM,CAAC4B,KAAK,CAAC,gBAAgB,EAAE,qCAAqC,CAAC;MACjF;MAEA,OAAOF,SAAS,CAACf,QAAQ;IAC3B,CAAC;IAED;IACA,uBAAuB,EAAE,eAAAmB,CAAezB,KAAK,EAAE;MAC7CI,KAAK,CAACJ,KAAK,EAAEK,MAAM,CAAC;MACpB,MAAMqB,MAAM,GAAG,MAAM1C,UAAU,CAACsC,YAAY,CAAC;QAAEtB;MAAM,CAAC,CAAC;MACvDW,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAEZ,KAAK,CAAC;MACxCW,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAEc,MAAM,CAAC;MACxC,OAAOA,MAAM;IACf;EACF,CAAC,CAAC;;EAEF;EACA,IAAI/B,MAAM,CAACC,QAAQ,EAAE;IACnBD,MAAM,CAACgC,OAAO,CAAC,mBAAmB,EAAE,UAAS5B,MAAM,EAAE;MACnDK,KAAK,CAACL,MAAM,EAAEM,MAAM,CAAC;MACrB,OAAOrB,UAAU,CAAC4C,IAAI,CAAC;QAAE7B,MAAM,EAAEA;MAAO,CAAC,CAAC;IAC5C,CAAC,CAAC;IAEFJ,MAAM,CAACgC,OAAO,CAAC,qBAAqB,EAAE,UAASvC,UAAU,EAAE;MACzDgB,KAAK,CAAChB,UAAU,EAAEiB,MAAM,CAAC;MACzB,OAAOrB,UAAU,CAAC4C,IAAI,CAAC;QAAExC,UAAU,EAAEA;MAAW,CAAC,CAAC;IACpD,CAAC,CAAC;EACJ;AAAA,EAAAyC,IAAA,OAAAC,MAAA","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"9ad1f4e209a03c676ddcc627e0667422059891c7"}
